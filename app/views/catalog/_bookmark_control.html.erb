<% if current_or_guest_user %>
    <%-
        # Note these two forms are pretty similar but for different :methods, classes, and labels.
        # but it was simpler to leave them seperate instead of DRYing them, got confusing trying that.
        # the data-doc-id attribute is used by our JS that converts to a checkbox/label.
    -%>
    <% if current_bookmarks.find { |x| x.document_id == document.id and x.document_type == document.class }.blank? %>
        <%= form_tag( bookmark_path( document ), :method => :put, :class => "bookmark_toggle", "data-doc-id" => document.id, :'data-present' => t('blacklight.search.bookmarks.present'), :'data-absent' => t('blacklight.search.bookmarks.absent'), :'data-inprogress' => t('blacklight.search.bookmarks.inprogress')) do %>
        <% end %>
    <% else %>
        <%= form_tag( bookmark_path( document ), :method => :delete, :class => "bookmark_toggle", "data-doc-id" => document.id, :'data-present' => t('blacklight.search.bookmarks.present'), :'data-absent' => t('blacklight.search.bookmarks.absent'), :'data-inprogress' => t('blacklight.search.bookmarks.inprogress')) do %>
        <% end %>
    <% end %>
    <label class="bookmark_manage">
      <i class="fa fa-bookmark"></i>&nbsp;&nbsp;
      <% bookmark_params = {:view => 'grid'} %>
      <% if local_assigns[:document][Solrizer.solr_name('object_type', :displayable, type: :string).to_sym].first == 'Collection' %>
          <% bookmark_params[:mode] = 'collections' %>
      <% else %>
          <% bookmark_params[:mode] = 'objects' %>
      <% end %>
      <%= link_to t('dri.views.catalog.forms.manage_bookmark'), bookmarks_path(bookmark_params), :id => 'manage_bookmark' %>
    </label>
<% else %>
    &nbsp;
<% end %>
