<% if can? :read, @document %>
    <% get_files @document %>

    <% unless @files.empty? %>

        <% @generic_file = @files.first %>

        <div class="dri_asset_holder">

          <% if @generic_file.audio? %>
              <% @surrogate = surrogate_url(@document.id, @generic_file.id, "mp3") %>
              <% unless @surrogate.nil? %>
                  <audio controls>
                    <source src="<%= @surrogate %>" type="audio/mpeg">
                  </audio>
              <% end %>

          <% elsif @generic_file.video? %>
              <% @surrogate = surrogate_url(@document.id, @generic_file.id, "mp4") %>
              <% unless @surrogate.nil? %>
                  <video width="320" height="240" controls>
                    <source src="<%= @surrogate %>" type="video/mp4">
                  </video>
              <% end %>

          <% elsif @generic_file.pdf? %>
              <% @surrogate = surrogate_url(@document.id, @generic_file.id, "thumbnail_large") %>
              <% @surrogate_colorbox = surrogate_url(@document.id, @generic_file.id, "lightbox_format") %>
              <% unless @surrogate.nil?  %>
                  <%= link_to @surrogate_colorbox, :data => { :colorbox => true } do %>
                      <img class="dri_float_right" src="<%= @surrogate %>">
                  <% end %>
              <% end %>

          <% elsif @generic_file.image? %>
              <% @surrogate = surrogate_url(@document.id, @generic_file.id, "thumbnail_large") %>
              <% @surrogate_colorbox = surrogate_url(@document.id, @generic_file.id, "lightbox_format") %>
              <% unless @surrogate.nil? %>
                  <%= link_to @surrogate_colorbox, :data => { :colorbox => true } do %>
                      <img class="dri_float_right" src="<%= @surrogate %>">
                  <% end %>
              <% end %>
          <% end %>

          <% if @surrogate.blank? %>
              <p><%= t('dri.views.catalog.legends.no_surrogates') %></p>
          <% end %>

        </div>

    <% end %>

<% else %>

    <h2 class="dri_restrict_title"><%= t('dri.views.catalog.forms.restricted_asset') %></h2>
    <p class="dri_restrict_message"><%= t('dri.views.catalog.legends.no_permission') %></p>
    <% if current_user %>
        <% governing_collection = governing_collection_solr(@document) %>
        <% reader_group = reader_group(governing_collection) %>
        <% pending = reader_group.pending_memberships %>

        <% if pending.find_by_user_id(current_user.id).nil? %>
            <%= form_for(reader_group.memberships.build, url: user_group.pending_memberships_path, :method => :post) do |f| %>
                <%= render partial: 'user_group/shared/error_messages', locals: {object: f.object} %>
                <%= f.hidden_field :user_id, value: current_user.id %>
                <%= f.hidden_field :group_id , value: reader_group.id %>
                <%= f.submit t('dri.views.catalog.legends.request_permission_logged_in'), :class => 'dri_request_access_button' %>
            <% end %>
        <% else %>
            <p class="dri_restrict_progress"><%= t('dri.views.catalog.legends.request_permission_in_progress') %></p>
        <% end %>
    <% else %>
        <p class="dri_restrict_message"><%= t('dri.views.catalog.legends.request_permission_not_logged_in') %></p>
    <% end %>

<% end %>
