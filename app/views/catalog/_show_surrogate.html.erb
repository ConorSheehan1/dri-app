<% if can? :read, @document %>
<% get_files @document %>
  <% unless @files.empty? %>

        <% if can? :read, @document %>
        <% surrogates = get_surrogates @document, @files[0] %>
        <% if surrogates.empty? %>
          <p><%= t('dri.views.catalog.legends.no_surrogates') %></p>
        <% else %>
          <% surrogates.each do |desc, url| %>
               <% case desc when "thumbnail_large" %>
               
                <div class="dri_asset_holder">
                <%= link_to url, :data => { :colorbox => true } do %>
      				<img class="dri_float_right" src="<%= url %>">		
      				<% end %>	
      			</div>

   			   <% end %>
          <% end %>
        <% end %>
      <% end %>

<% end %>
<% else %>

  <h2 class="dri_restrict_title"><%= t('dri.views.catalog.forms.restricted_asset') %></h2>
  <p class="dri_restrict_message"><%= t('dri.views.catalog.legends.no_permission') %></p>
  <% if current_user %>
    <% governing_collection = governing_collection_solr(@document) %>
    <% reader_group = reader_group(governing_collection) %>
    <% pending = reader_group.pending_memberships %>
    
    <% if pending.find_by_user_id(current_user.id).nil? %>
      <%= form_for(reader_group.memberships.build, url: user_group.pending_memberships_path, :method => :post) do |f| %>
        <%= render partial: 'user_group/shared/error_messages', locals: {object: f.object} %>
        <%= f.hidden_field :user_id, value: current_user.id %>
        <%= f.hidden_field :group_id , value: reader_group.id %>
        <%= f.submit t('dri.views.catalog.legends.request_permission_logged_in'), :class => 'dri_request_access_button' %>
      <% end %>
    <% else %>
      <p class="dri_restrict_progress"><%= t('dri.views.catalog.legends.request_permission_in_progress') %></p>
    <% end %>
  <% else %>
    <%= t('dri.views.catalog.legends.request_permission_not_logged_in') %>
  <% end %>

<% end %>
